class t{static counter=0;children=[];watchers=[];actions=new Map;values=new Map;constructor(t,e){this.id=t,this.parent=e,t=t||0}value(t,e){this.values.set(t,e)}action(t,e){this.actions.set(t,e)}new(){t.counter++;const e=new t(t.counter,this);return this.children.push(e),e}watch(t){this.watchers.push(t)}exec(t){const e=this.actions.get(t);return e?e(this):void 0}destroy(){const t=this.parent?.children;t&&t.splice(t.indexOf(this),1)}digest(){let t;for(let e=0;e<this.watchers.length;e++){t=this.watchers[e];const i=this.values.get(t.act);i&&i!==t.last&&(t.last=i,t.fn(i))}for(let t=0;t<this.children.length;t++)this.children[t].digest()}}class e{_directives=new Map;_controller=new Map;_root=new t;static instance(){return e._instance||(e._instance=new e),e._instance}controller(t,e){this._controller.set(t,e)}directive(t,e){this._directives.set(t,e)}get(t){return this._directives.get(t)}invoke(t){const e=this._controller.get(t);e&&e(this._root)}root(){return this._root}}class i{static bootstrap(){this.compile(document.children[0],e.instance().root())}static callDirectives(t,i){for(let s=0;s<t.attributes.length;s++){const n=t.attributes[s],c=e.instance().get(n.name);c&&t instanceof HTMLElement&&c.link(t,i,n.value)}}static compile(t,e){this.callDirectives(t,e);for(let i=0;i<t.children.length;i++){const s=t.children.item(i);null!==s&&this.compile(s,e)}}}e.instance().directive("sqt-repeat",{scope:!1,link:(t,e,s)=>{let n=[];const c=s.split("in"),r=c[1].trim(),o=c[0].trim(),a=t.parentNode,l=s=>{for(var c,r,l=s;a&&a.firstChild;)a.removeChild(a.firstChild);n.forEach(t=>{t.destroy()}),n=[],l.forEach(s=>{(c=t.cloneNode()).removeAttribute("sqt-repeat"),c.removeAttribute("sqt-scope"),r=e.new(),n.push(r),r.value(o,s),i.compile(c,r),a&&a.appendChild(c)})};e.watch({act:r,fn:t=>{const i=e.values.get(r);i&&Array.isArray(i)&&l(i)}});const h=e.values.get(r);h&&Array.isArray(h)&&l(h)}}),e.instance().directive("sqt-controller",{scope:!1,link:(t,i,s)=>{e.instance().invoke(s)}}),e.instance().directive("sqt-bind",{scope:!1,link:(t,e,i)=>{t.innerHTML=e.exec(i)||"",e.watch({act:i,fn:e=>{Array.isArray(e)||(t.innerHTML=e)}})}}),e.instance().directive("sqt-click",{scope:!1,link:(t,e,i)=>{t.onclick=()=>{e.exec(i),e.digest()}}}),e.instance().directive("sqt-model",{scope:!1,link:(t,e,i)=>{t instanceof HTMLInputElement&&(t.onkeyup=()=>{e.value(i,t.value),e.digest()},e.watch({act:i,fn:e=>{Array.isArray(e)||(t.value=e)}}))}}),e.instance().controller("MainCtrl",t=>{t.action("foo",t=>{console.log("clicked")}),t.action("add()",t=>{const e=t.values.get("todos")||[],i=t.values.get("todos")||"empty";e.push(i),t.value("todos",e)})}),i.bootstrap();
